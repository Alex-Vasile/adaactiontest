name: Windows

on:
  workflow_dispatch:

jobs:
  Windows:
    runs-on: windows-latest

    steps:
      - name: MSYS Setup   
      - name: GNAT Install
        shell: powershell
        run: |
          cd C:\msys64\
          # https://www.msys2.org/wiki/MSYS2-installation/
          .\msys2.exe pacman -Syuu --noconfirm
          .\msys2.exe pacman -Syuu --noconfirm
          # https://packages.msys2.org/package/mingw-w64-x86_64-gcc-ada
          .\msys2.exe pacman --noconfirm -S mingw-w64-x86_64-gcc-ada
          # https://packages.msys2.org/package/mingw-w64-x86_64-gprbuild
          .\msys2.exe pacman --noconfirm -S mingw-w64-x86_64-gprbuild
          # https://www.msys2.org/wiki/Porting/
          .\msys2.exe pacman --noconfirm -S mingw-w64-x86_64-make

      - name: Whitakers-Words Checkout
        uses: actions/checkout@v2
        with: 
          path: 'whitakers-words'

      - name: Whitakers-Words Build and Test
        run: |
          cd whitakers-words
          make all
          make test

      - name: Binary Organize
        run: |
          mkdir words
          mv whitakers-words/LICENCE.txt    words/
          mv whitakers-words/bin            words/
          mv whitakers-words/ADDONS.LAT     words/
          mv whitakers-words/DICTFILE.GEN   words/
          mv whitakers-words/EWDSFILE.GEN   words/
          mv whitakers-words/INDXFILE.GEN   words/
          mv whitakers-words/INFLECTS.SEC   words/
          mv whitakers-words/STEMFILE.GEN   words/
          mv whitakers-words/UNIQUES.LAT    words/
      
      - name: Binary Export
        uses: actions/upload-artifact@v2
        with:
          name: words-Windows-x64
          path: |
            words
